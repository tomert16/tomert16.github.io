{"ast":null,"code":"import { Base } from './Base.js';\nimport { Number as NumberT } from './Number.js';\nimport * as utils from './utils.js';\nclass ArrayT extends Base {\n  constructor(type, length) {\n    let lengthType = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'count';\n    super();\n    this.type = type;\n    this.length = length;\n    this.lengthType = lengthType;\n  }\n  decode(stream, parent) {\n    let length;\n    const {\n      pos\n    } = stream;\n    const res = [];\n    let ctx = parent;\n    if (this.length != null) {\n      length = utils.resolveLength(this.length, stream, parent);\n    }\n    if (this.length instanceof NumberT) {\n      // define hidden properties\n      Object.defineProperties(res, {\n        parent: {\n          value: parent\n        },\n        _startOffset: {\n          value: pos\n        },\n        _currentOffset: {\n          value: 0,\n          writable: true\n        },\n        _length: {\n          value: length\n        }\n      });\n      ctx = res;\n    }\n    if (length == null || this.lengthType === 'bytes') {\n      const target = length != null ? stream.pos + length : (parent != null ? parent._length : undefined) ? parent._startOffset + parent._length : stream.length;\n      while (stream.pos < target) {\n        res.push(this.type.decode(stream, ctx));\n      }\n    } else {\n      for (let i = 0, end = length; i < end; i++) {\n        res.push(this.type.decode(stream, ctx));\n      }\n    }\n    return res;\n  }\n  size(array, ctx) {\n    let includePointers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    if (!array) {\n      return this.type.size(null, ctx) * utils.resolveLength(this.length, null, ctx);\n    }\n    let size = 0;\n    if (this.length instanceof NumberT) {\n      size += this.length.size();\n      ctx = {\n        parent: ctx,\n        pointerSize: 0\n      };\n    }\n    for (let item of array) {\n      size += this.type.size(item, ctx);\n    }\n    if (ctx && includePointers && this.length instanceof NumberT) {\n      size += ctx.pointerSize;\n    }\n    return size;\n  }\n  encode(stream, array, parent) {\n    let ctx = parent;\n    if (this.length instanceof NumberT) {\n      ctx = {\n        pointers: [],\n        startOffset: stream.pos,\n        parent\n      };\n      ctx.pointerOffset = stream.pos + this.size(array, ctx, false);\n      this.length.encode(stream, array.length);\n    }\n    for (let item of array) {\n      this.type.encode(stream, item, ctx);\n    }\n    if (this.length instanceof NumberT) {\n      let i = 0;\n      while (i < ctx.pointers.length) {\n        const ptr = ctx.pointers[i++];\n        ptr.type.encode(stream, ptr.val, ptr.parent);\n      }\n    }\n  }\n}\nexport { ArrayT as Array };","map":{"version":3,"names":["Base","Number","NumberT","utils","ArrayT","constructor","type","length","lengthType","arguments","undefined","decode","stream","parent","pos","res","ctx","resolveLength","Object","defineProperties","value","_startOffset","_currentOffset","writable","_length","target","push","i","end","size","array","includePointers","pointerSize","item","encode","pointers","startOffset","pointerOffset","ptr","val","Array"],"sources":["/Users/tomertal/Development/code/portfolio-site/node_modules/restructure/src/Array.js"],"sourcesContent":["import {Base} from './Base.js';\nimport {Number as NumberT} from './Number.js';\nimport * as utils from './utils.js';\n\nclass ArrayT extends Base {\n  constructor(type, length, lengthType = 'count') {\n    super();\n    this.type = type;\n    this.length = length;\n    this.lengthType = lengthType;\n  }\n\n  decode(stream, parent) {\n    let length;\n    const { pos } = stream;\n\n    const res = [];\n    let ctx = parent;\n\n    if (this.length != null) {\n      length = utils.resolveLength(this.length, stream, parent);\n    }\n\n    if (this.length instanceof NumberT) {\n      // define hidden properties\n      Object.defineProperties(res, {\n        parent:         { value: parent },\n        _startOffset:   { value: pos },\n        _currentOffset: { value: 0, writable: true },\n        _length:        { value: length }\n      });\n\n      ctx = res;\n    }\n\n    if ((length == null) || (this.lengthType === 'bytes')) {\n      const target = (length != null) ?\n        stream.pos + length\n      : (parent != null ? parent._length : undefined) ?\n        parent._startOffset + parent._length\n      :\n        stream.length;\n\n      while (stream.pos < target) {\n        res.push(this.type.decode(stream, ctx));\n      }\n\n    } else {\n      for (let i = 0, end = length; i < end; i++) {\n        res.push(this.type.decode(stream, ctx));\n      }\n    }\n\n    return res;\n  }\n\n  size(array, ctx, includePointers = true) {\n    if (!array) {\n      return this.type.size(null, ctx) * utils.resolveLength(this.length, null, ctx);\n    }\n\n    let size = 0;\n    if (this.length instanceof NumberT) {\n      size += this.length.size();\n      ctx = {parent: ctx, pointerSize: 0};\n    }\n\n    for (let item of array) {\n      size += this.type.size(item, ctx);\n    }\n\n    if (ctx && includePointers && this.length instanceof NumberT) {\n      size += ctx.pointerSize;\n    }\n    \n    return size;\n  }\n\n  encode(stream, array, parent) {\n    let ctx = parent;\n    if (this.length instanceof NumberT) {\n      ctx = {\n        pointers: [],\n        startOffset: stream.pos,\n        parent\n      };\n\n      ctx.pointerOffset = stream.pos + this.size(array, ctx, false);\n      this.length.encode(stream, array.length);\n    }\n\n    for (let item of array) {\n      this.type.encode(stream, item, ctx);\n    }\n\n    if (this.length instanceof NumberT) {\n      let i = 0;\n      while (i < ctx.pointers.length) {\n        const ptr = ctx.pointers[i++];\n        ptr.type.encode(stream, ptr.val, ptr.parent);\n      }\n    }\n  }\n}\n\nexport {ArrayT as Array};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}