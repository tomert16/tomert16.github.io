{"ast":null,"code":"import { Base } from './Base.js';\nimport * as utils from './utils.js';\nexport class Struct extends Base {\n  constructor() {\n    let fields = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    this.fields = fields;\n  }\n  decode(stream, parent) {\n    let length = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    const res = this._setup(stream, parent, length);\n    this._parseFields(stream, res, this.fields);\n    if (this.process != null) {\n      this.process.call(res, stream);\n    }\n    return res;\n  }\n  _setup(stream, parent, length) {\n    const res = {};\n\n    // define hidden properties\n    Object.defineProperties(res, {\n      parent: {\n        value: parent\n      },\n      _startOffset: {\n        value: stream.pos\n      },\n      _currentOffset: {\n        value: 0,\n        writable: true\n      },\n      _length: {\n        value: length\n      }\n    });\n    return res;\n  }\n  _parseFields(stream, res, fields) {\n    for (let key in fields) {\n      var val;\n      const type = fields[key];\n      if (typeof type === 'function') {\n        val = type.call(res, res);\n      } else {\n        val = type.decode(stream, res);\n      }\n      if (val !== undefined) {\n        if (val instanceof utils.PropertyDescriptor) {\n          Object.defineProperty(res, key, val);\n        } else {\n          res[key] = val;\n        }\n      }\n      res._currentOffset = stream.pos - res._startOffset;\n    }\n  }\n  size(val, parent) {\n    let includePointers = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    if (val == null) {\n      val = {};\n    }\n    const ctx = {\n      parent,\n      val,\n      pointerSize: 0\n    };\n    if (this.preEncode != null) {\n      this.preEncode.call(val);\n    }\n    let size = 0;\n    for (let key in this.fields) {\n      const type = this.fields[key];\n      if (type.size != null) {\n        size += type.size(val[key], ctx);\n      }\n    }\n    if (includePointers) {\n      size += ctx.pointerSize;\n    }\n    return size;\n  }\n  encode(stream, val, parent) {\n    let type;\n    if (this.preEncode != null) {\n      this.preEncode.call(val, stream);\n    }\n    const ctx = {\n      pointers: [],\n      startOffset: stream.pos,\n      parent,\n      val,\n      pointerSize: 0\n    };\n    ctx.pointerOffset = stream.pos + this.size(val, ctx, false);\n    for (let key in this.fields) {\n      type = this.fields[key];\n      if (type.encode != null) {\n        type.encode(stream, val[key], ctx);\n      }\n    }\n    let i = 0;\n    while (i < ctx.pointers.length) {\n      const ptr = ctx.pointers[i++];\n      ptr.type.encode(stream, ptr.val, ptr.parent);\n    }\n  }\n}","map":{"version":3,"names":["Base","utils","Struct","constructor","fields","arguments","length","undefined","decode","stream","parent","res","_setup","_parseFields","process","call","Object","defineProperties","value","_startOffset","pos","_currentOffset","writable","_length","key","val","type","PropertyDescriptor","defineProperty","size","includePointers","ctx","pointerSize","preEncode","encode","pointers","startOffset","pointerOffset","i","ptr"],"sources":["/Users/tomertal/Development/code/portfolio-site/node_modules/restructure/src/Struct.js"],"sourcesContent":["import {Base} from './Base.js';\nimport * as utils from './utils.js';\n\nexport class Struct extends Base {\n  constructor(fields = {}) {\n    super();\n    this.fields = fields;\n  }\n\n  decode(stream, parent, length = 0) {\n    const res = this._setup(stream, parent, length);\n    this._parseFields(stream, res, this.fields);\n\n    if (this.process != null) {\n      this.process.call(res, stream);\n    }\n    return res;\n  }\n\n  _setup(stream, parent, length) {\n    const res = {};\n\n    // define hidden properties\n    Object.defineProperties(res, {\n      parent:         { value: parent },\n      _startOffset:   { value: stream.pos },\n      _currentOffset: { value: 0, writable: true },\n      _length:        { value: length }\n    });\n\n    return res;\n  }\n\n  _parseFields(stream, res, fields) {\n    for (let key in fields) {\n      var val;\n      const type = fields[key];\n      if (typeof type === 'function') {\n        val = type.call(res, res);\n      } else {\n        val = type.decode(stream, res);\n      }\n\n      if (val !== undefined) {\n        if (val instanceof utils.PropertyDescriptor) {\n          Object.defineProperty(res, key, val);\n        } else {\n          res[key] = val;\n        }\n      }\n\n      res._currentOffset = stream.pos - res._startOffset;\n    }\n\n  }\n\n  size(val, parent, includePointers = true) {\n    if (val == null) { val = {}; }\n    const ctx = {\n      parent,\n      val,\n      pointerSize: 0\n    };\n\n    if (this.preEncode != null) {\n      this.preEncode.call(val);\n    }\n\n    let size = 0;\n    for (let key in this.fields) {\n      const type = this.fields[key];\n      if (type.size != null) {\n        size += type.size(val[key], ctx);\n      }\n    }\n\n    if (includePointers) {\n      size += ctx.pointerSize;\n    }\n\n    return size;\n  }\n\n  encode(stream, val, parent) {\n    let type;\n    if (this.preEncode != null) {\n      this.preEncode.call(val, stream);\n    }\n\n    const ctx = {\n      pointers: [],\n      startOffset: stream.pos,\n      parent,\n      val,\n      pointerSize: 0\n    };\n\n    ctx.pointerOffset = stream.pos + this.size(val, ctx, false);\n\n    for (let key in this.fields) {\n      type = this.fields[key];\n      if (type.encode != null) {\n        type.encode(stream, val[key], ctx);\n      }\n    }\n\n    let i = 0;\n    while (i < ctx.pointers.length) {\n      const ptr = ctx.pointers[i++];\n      ptr.type.encode(stream, ptr.val, ptr.parent);\n    }\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}